{"version":3,"sources":["ng://ngx-file-drop/src/lib/ngx-drop/upload-file.model.ts","ng://ngx-file-drop/src/lib/ngx-drop/upload-event.model.ts","ng://ngx-file-drop/src/lib/ngx-drop/file-drop.component.ts","ng://ngx-file-drop/src/lib/ngx-drop/file-drop.module.ts"],"names":["UploadFile","relativePath","fileEntry","this","UploadEvent","files","FileComponent","zone","renderer","_this","headertext","customstyle","customContentStyle","disableIf","showBrowseBtn","customBtnStyling","browseBtnLabel","onFileDrop","EventEmitter","onFileOver","onFileLeave","stack","subscription","dragoverflag","globalDisable","numOfActiveReadEntries","globalStart","listen","evt","globalEnd","prototype","onDragOver","event","isDropzoneDisabled","emit","preventAndStop","onDragLeave","dropFiles","dataTransfer","dropEffect","items","checkFiles","onBrowseButtonClick","fileSelector","nativeElement","click","uploadFiles","target","i","item","entry","this_1","canGetAsEntry","webkitGetAsEntry","isFile","toUpload","name","addToQueue","isDirectory","traverseFileTree","fakeFileEntry","file","callback","length","timerObservable","timer","unsubscribe","subscribe","t","path","push","run","popFromStack","pushToStack","dirReader_1","createReader","entries_1","thisObj_1","readEntries_1","readEntries","res","concat","toUpload_1","str","pop","clearQueue","stopPropagation","preventDefault","ngOnDestroy","Component","args","selector","template","NgZone","Renderer2","Input","Output","ViewChild","FileDropModule","NgModule","declarations","exports","imports","CommonModule","providers","bootstrap"],"mappings":"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","sourcesContent":["import { FileSystemEntry, FileSystemFileEntry, FileSystemDirectoryEntry } from './dom.types';\r\n\r\n/**\r\n * fileEntry is an instance of {@link FileSystemFileEntry} or {@link FileSystemDirectoryEntry}.\r\n * Which one is it can be checked using {@link FileSystemEntry.isFile} or {@link FileSystemEntry.isDirectory}\r\n * properties of the given {@link FileSystemEntry}.\r\n */\r\nexport class UploadFile {\r\n    constructor(\r\n        public relativePath: string,\r\n        public fileEntry: FileSystemEntry) {\r\n    }\r\n}\r\n","import { UploadFile } from './upload-file.model';\r\n\r\nexport class UploadEvent {\r\n    constructor(\r\n        public files: UploadFile[]) {\r\n    }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  NgZone,\r\n  OnDestroy,\r\n  Renderer2,\r\n  ViewChild,\r\n  ElementRef\r\n} from '@angular/core';\r\nimport { timer, Subscription } from 'rxjs';\r\n\r\nimport { UploadFile } from './upload-file.model';\r\nimport { UploadEvent } from './upload-event.model';\r\nimport { FileSystemFileEntry, FileSystemEntry, FileSystemDirectoryEntry } from './dom.types';\r\n\r\n@Component({\r\n  selector: 'file-drop',\r\n  templateUrl: './file-drop.component.html',\r\n  styleUrls: ['./file-drop.component.scss']\r\n})\r\nexport class FileComponent implements OnDestroy {\r\n\r\n  @Input()\r\n  public headertext: string = '';\r\n  @Input()\r\n  public customstyle: string = 'drop-zone';\r\n  @Input()\r\n  public customContentStyle: string = 'content';\r\n  @Input()\r\n  public disableIf: boolean = false;\r\n  @Input()\r\n  public showBrowseBtn: boolean = false;\r\n  @Input()\r\n  public customBtnStyling: string = 'btn btn-primary btn-xs';\r\n  @Input()\r\n  public browseBtnLabel: string = 'Browse files';\r\n\r\n  @Output()\r\n  public onFileDrop: EventEmitter<UploadEvent> = new EventEmitter<UploadEvent>();\r\n  @Output()\r\n  public onFileOver: EventEmitter<any> = new EventEmitter<any>();\r\n  @Output()\r\n  public onFileLeave: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n  @ViewChild('fileSelector')\r\n  public fileSelector: ElementRef;\r\n\r\n  stack: string[] = [];\r\n  files: UploadFile[] = [];\r\n  subscription: Subscription | null = null;\r\n  dragoverflag: boolean = false;\r\n\r\n  globalDisable: boolean = false;\r\n  globalStart: Function;\r\n  globalEnd: Function;\r\n\r\n  numOfActiveReadEntries = 0;\r\n\r\n  constructor(\r\n    private zone: NgZone,\r\n    private renderer: Renderer2\r\n  ) {\r\n    this.globalStart = this.renderer.listen('document', 'dragstart', (evt: Event) => {\r\n      this.globalDisable = true;\r\n    });\r\n    this.globalEnd = this.renderer.listen('document', 'dragend', (evt: Event) => {\r\n      this.globalDisable = false;\r\n    });\r\n  }\r\n\r\n  public onDragOver(event: Event): void {\r\n    if (!this.isDropzoneDisabled()) {\r\n      if (!this.dragoverflag) {\r\n        this.dragoverflag = true;\r\n        this.onFileOver.emit(event);\r\n      }\r\n      this.preventAndStop(event);\r\n    }\r\n  }\r\n\r\n  public onDragLeave(event: Event): void {\r\n    if (!this.isDropzoneDisabled()) {\r\n      if (this.dragoverflag) {\r\n        this.dragoverflag = false;\r\n        this.onFileLeave.emit(event);\r\n      }\r\n      this.preventAndStop(event);\r\n    }\r\n  }\r\n\r\n  public dropFiles(event: DragEvent): void {\r\n    if (!this.isDropzoneDisabled()) {\r\n      this.dragoverflag = false;\r\n      if (event.dataTransfer) {\r\n        event.dataTransfer.dropEffect = 'copy';\r\n        let items: FileList | DataTransferItemList;\r\n        if (event.dataTransfer.items) {\r\n          items = event.dataTransfer.items;\r\n        } else {\r\n          items = event.dataTransfer.files;\r\n        }\r\n        this.preventAndStop(event);\r\n        this.checkFiles(items);\r\n      }\r\n    }\r\n  }\r\n\r\n  public onBrowseButtonClick(event: MouseEvent): void {\r\n    if (this.fileSelector && this.fileSelector.nativeElement) {\r\n      (this.fileSelector.nativeElement as HTMLInputElement).click();\r\n    }\r\n  }\r\n\r\n  public uploadFiles(event: Event): void {\r\n    if (!this.isDropzoneDisabled()) {\r\n      if (event.target) {\r\n        const items = (event.target as HTMLInputElement).files || ([] as any);\r\n        this.checkFiles(items);\r\n      }\r\n    }\r\n  }\r\n\r\n  private checkFiles(items: FileList | DataTransferItemList): void {\r\n    for (let i = 0; i < items.length; i++) {\r\n      const item = items[i];\r\n      let entry: FileSystemEntry | null = null;\r\n      if (this.canGetAsEntry(item)) {\r\n        entry = item.webkitGetAsEntry();\r\n      }\r\n\r\n      if (!entry) {\r\n        if (item) {\r\n          const fakeFileEntry: FileSystemFileEntry = {\r\n            name: (item as File).name,\r\n            isDirectory: false,\r\n            isFile: true,\r\n            file: (callback: (filea: File) => void): void => {\r\n              callback(item as File)\r\n            }\r\n          };\r\n          const toUpload: UploadFile = new UploadFile(fakeFileEntry.name, fakeFileEntry);\r\n          this.addToQueue(toUpload);\r\n        }\r\n      } else {\r\n        if (entry.isFile) {\r\n          const toUpload: UploadFile = new UploadFile(entry.name, entry);\r\n          this.addToQueue(toUpload);\r\n        } else if (entry.isDirectory) {\r\n          this.traverseFileTree(entry, entry.name);\r\n        }\r\n      }\r\n    }\r\n\r\n    const timerObservable = timer(200, 200);\r\n    if (this.subscription) {\r\n      this.subscription.unsubscribe();\r\n    }\r\n    this.subscription = timerObservable.subscribe(t => {\r\n      if (this.files.length > 0 && this.numOfActiveReadEntries === 0) {\r\n        this.onFileDrop.emit(new UploadEvent(this.files));\r\n        this.files = [];\r\n      }\r\n    });\r\n  }\r\n\r\n  private traverseFileTree(item: FileSystemEntry, path: string): void {\r\n    if (item.isFile) {\r\n      const toUpload: UploadFile = new UploadFile(path, item);\r\n      this.files.push(toUpload);\r\n      this.zone.run(() => {\r\n        this.popFromStack();\r\n      });\r\n    } else {\r\n      this.pushToStack(path);\r\n      path = path + '/';\r\n      const dirReader = (item as FileSystemDirectoryEntry).createReader();\r\n      let entries: FileSystemEntry[] = [];\r\n      const thisObj = this;\r\n\r\n      const readEntries = function () {\r\n        thisObj.numOfActiveReadEntries++;\r\n        dirReader.readEntries(function (res) {\r\n          if (!res.length) {\r\n            // add empty folders\r\n            if (entries.length === 0) {\r\n              const toUpload: UploadFile = new UploadFile(path, item);\r\n              thisObj.zone.run(() => {\r\n                thisObj.addToQueue(toUpload);\r\n              });\r\n            } else {\r\n              for (let i = 0; i < entries.length; i++) {\r\n                thisObj.zone.run(() => {\r\n                  thisObj.traverseFileTree(entries[i], path + entries[i].name);\r\n                });\r\n              }\r\n            }\r\n            thisObj.zone.run(() => {\r\n              thisObj.popFromStack();\r\n            });\r\n          } else {\r\n            // continue with the reading\r\n            entries = entries.concat(res);\r\n            readEntries();\r\n          }\r\n          thisObj.numOfActiveReadEntries--\r\n        });\r\n      };\r\n\r\n      readEntries();\r\n    }\r\n  }\r\n\r\n  private canGetAsEntry(item: any): item is DataTransferItem {\r\n    return !!item.webkitGetAsEntry;\r\n  }\r\n\r\n  private isDropzoneDisabled(): boolean {\r\n    return (this.globalDisable || this.disableIf);\r\n  }\r\n\r\n  private addToQueue(item: UploadFile): void {\r\n    this.files.push(item);\r\n  }\r\n\r\n  pushToStack(str: string): void {\r\n    this.stack.push(str);\r\n  }\r\n\r\n  popFromStack(): string | undefined {\r\n    return this.stack.pop();\r\n  }\r\n\r\n  private clearQueue(): void {\r\n    this.files = [];\r\n  }\r\n\r\n  private preventAndStop(event: Event): void {\r\n    event.stopPropagation();\r\n    event.preventDefault();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.subscription) {\r\n      this.subscription.unsubscribe();\r\n      this.subscription = null;\r\n    }\r\n    this.globalStart();\r\n    this.globalEnd();\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport {FileComponent} from './file-drop.component';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    FileComponent,\r\n  ],\r\n  exports: [FileComponent],\r\n  imports: [CommonModule],\r\n  providers: [],\r\n  bootstrap: [FileComponent],\r\n})\r\nexport class FileDropModule {}\r\n"]}